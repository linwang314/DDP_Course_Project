---
title       : US Energy Profile Application
subtitle    : Develop Data Product Course Project
author      : Lin Wang
job         : 
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
---

## Background and Data

* [The U.S. Energy Information Administration (EIA)](http://www.eia.gov/about/) collects, analyzes, and disseminates independent and impartial energy information to promote sound policymaking, efficient markets, and public understanding of energy and its interaction with the economy and the environment.  
* EIA publishes data on energy that comes from a variety of sources, including petroleum, coal, natural gas, nuclear and renewable sources. It also collects data on energy production, consumption, efficiency, and market. 
* Data used for this web application are from [EIA total energy annual data](https://www.eia.gov/totalenergy/data/annual/index.cfm). Under subsection Energy Overview, data tables 1.1 - 1.4 were downloaded. 

--- 

## Web Application Overview

#### The ui.R asks for two inputs from the user:  
1. a category of data of choice (select input)  
2. a range of years of interest (slider input)  

#### The server.R realizes the following objectives:  
1. read raw data  
2. process raw data into clean and relevant data for app use  
3. create a energy vs. time line plot based on user input 

---

## Application Example  

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(shiny)
library(ggplot2)
library(dplyr)
library(tidyr)
```
Every time a user opens the web application, the server.R first reads the raw data.  
```{r}
## Read raw data (need to change to the directory that contains both data and scripts)
overview <- read.csv("C:/Users/linwa_000/DDP_Course_Project/MER_T01_01.csv")
production <- read.csv("C:/Users/linwa_000/DDP_Course_Project/MER_T01_02.csv", na.strings = "Not Available")
consumption <- read.csv("C:/Users/linwa_000/DDP_Course_Project/MER_T01_03.csv", na.strings = "Not Available")
import <- read.csv("C:/Users/linwa_000/DDP_Course_Project/MER_T01_04A.csv", na.strings = "Not Available")
export <- read.csv("C:/Users/linwa_000/DDP_Course_Project/MER_T01_04B.csv", na.strings = "Not Available")
```
Then a series of processing and transformation are performed to obtain clean data for plotting (code not shown).  
```{r, echo=FALSE}
## Subset relevant data 
overview <- filter(overview, Description %in% c("Total Primary Energy Production", "Total Primary Energy Consumption",
                                                "Primary Energy Imports", "Primary Energy Exports"))
production <- filter(production, Description %in% c("Biomass Energy Production", "Coal Production", "Crude Oil Production",
                                                    "Geothermal Energy Production", "Hydroelectric Power Production",
                                                    "Natural Gas (Dry) Production", "Natural Gas Plant Liquids Production",
                                                    "Nuclear Electric Power Production", "Solar/PV Energy Production",
                                                    "Wind Energy Production"))
import <- filter(import, !Description == "Total Primary Energy Imports")
export <- filter(export, !Description %in% c("Total Energy Exports", "Total Energy Net Imports"))

## Creat a list with all data frame so that lapply() can be used for convenient data processing and transformation
data <- list(overview = overview, production = production, consumption = consumption, import = import, export = export)

## Create a function for data processing and transformation
records <- function(x) {
  x <- x %>%
    separate(YYYYMM, c("year", "month"), 4)  %>%
    select(year, month, Description, Value)  %>%
    filter(month == "13") 
  x$year <- as.numeric(x$year)
  return(x)
}
## subdata are what needed for web application
subdata <- lapply(data, records)
```

---

## Application Example 

When a user is interested in "energy production by source" from 1950 to 2010, switch() function transforms the input into the right data set, and the plot is generated by ggplot:   
```{r, echo=FALSE, eval=FALSE}
dataforplot <- switch(input$category,
                        "energy overview" = subdata$overview,
                        "energy production by source" = subdata$production,
                        "energy consumption by source" = subdata$consumption,
                        "energy imports by source" = subdata$import,
                        "energy exports by source" = subdata$export)
```

```{r, echo=FALSE, eval=FALSE}
## the limits of x-axis are determined from the slider input (1950 - 2010)
ggplot(dataforplot, aes(x = year, y = Value, color = Description)) + geom_line() +
        labs(x = "Year", y = "Quadrillion Btu") + theme(legend.position = "bottom") +
        scale_x_continuous(limits = c(input$range[1], input$range[2]))
```

```{r, echo=FALSE, warning=FALSE}
ggplot(subdata[[2]], aes(x = year, y = Value, color = Description)) + geom_line() +
        labs(x = "Year", y = "Quadrillion Btu") + theme(legend.position = "bottom") +
        scale_x_continuous(limits = c(1950, 2010))
```
